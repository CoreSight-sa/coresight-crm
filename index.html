<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coresight CRM</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --cream:#f5f0e8;
  --cream2:#ede7d9;
  --cream3:#e4dccb;
  --white:#fdfaf5;
  --black:#0f0e0c;
  --black2:#1c1a17;
  --black3:#2e2b26;
  --ink:#3a3630;
  --ink2:#5a554d;
  --ink3:#8a8278;
  --gold:#b8922a;
  --gold2:#d4a832;
  --blue:#1a3a6b;
  --blue2:#2d5a9e;
  --green:#1a5c3a;
  --red:#7a1f1f;
  --orange:#8a4a0f;
  --purple:#4a2a6b;
  --teal:#0f4a4a;
  --border:#d4ccbc;
  --border2:#c4baaa;
  --r:6px;
  --shadow:0 2px 8px rgba(15,14,12,0.08);
  --shadow2:0 4px 20px rgba(15,14,12,0.12);
}
body{
  font-family:'Lato',sans-serif;
  background:var(--cream);
  color:var(--black);
  font-size:13px;
  min-height:100vh;
}
#root{display:flex;min-height:100vh}

/* SIDEBAR */
.sb{
  width:232px;
  background:var(--black);
  display:flex;flex-direction:column;
  position:fixed;top:0;left:0;bottom:0;z-index:100;
}
.sb-logo{
  padding:28px 24px 22px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
.sb-name{
  font-family:'Playfair Display',serif;
  font-size:22px;font-weight:700;
  color:var(--white);letter-spacing:-.3px;
}
.sb-name span{color:var(--gold2)}
.sb-tag{
  font-size:9px;color:rgba(255,255,255,0.35);
  letter-spacing:3px;text-transform:uppercase;
  margin-top:5px;font-weight:400;
}
.sb-nav{padding:16px 12px;flex:1}
.sb-sect{
  font-size:8px;color:rgba(255,255,255,0.2);
  letter-spacing:3px;text-transform:uppercase;
  padding:0 12px;margin:14px 0 6px;font-weight:700;
}
.sb-item{
  display:flex;align-items:center;gap:12px;
  padding:10px 14px;border-radius:5px;
  cursor:pointer;color:rgba(255,255,255,0.45);
  font-size:12px;font-weight:400;
  margin-bottom:1px;transition:all .18s;
  letter-spacing:.2px;
}
.sb-item:hover{background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.8)}
.sb-item.active{
  background:var(--gold);
  color:var(--black);
  font-weight:700;
}
.sb-item.active .sb-ico{color:var(--black)}
.sb-ico{font-size:13px;width:16px;text-align:center;opacity:.7}
.sb-item.active .sb-ico{opacity:1}
.sb-bottom{
  padding:14px 12px;
  border-top:1px solid rgba(255,255,255,0.08);
}
.sync-box{
  padding:12px 14px;border-radius:5px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
}
.sync-row{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.sdot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.sdot.ok{background:#4caf7a}
.sdot.saving{background:var(--gold2);animation:blink .9s infinite}
.sdot.error{background:#c0392b}
.sdot.loading{background:#5b8dd9;animation:blink .9s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.slabel{font-size:11px;font-weight:500}
.sdetail{font-size:10px;color:rgba(255,255,255,0.25)}

/* MAIN */
.main{margin-left:232px;flex:1;min-height:100vh;background:var(--cream)}

/* TOP BAR */
.topbar{
  background:var(--white);
  border-bottom:1px solid var(--border);
  padding:0 36px;
  height:60px;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:50;
  box-shadow:var(--shadow);
}
.topbar-left{display:flex;flex-direction:column}
.topbar-eyebrow{font-size:9px;color:var(--ink3);letter-spacing:2.5px;text-transform:uppercase;font-weight:700}
.topbar-title{font-family:'Playfair Display',serif;font-size:20px;font-weight:600;color:var(--black);line-height:1.1;margin-top:1px}
.topbar-actions{display:flex;gap:10px;align-items:center}

/* CONTENT */
.content{padding:28px 36px}

/* BUTTONS */
.btn{
  padding:10px 22px;border-radius:4px;border:none;
  cursor:pointer;font-family:'Lato',sans-serif;
  font-size:11px;font-weight:700;letter-spacing:1px;
  text-transform:uppercase;transition:all .18s;
  display:inline-flex;align-items:center;gap:8px;
}
.btn-black{background:var(--black);color:var(--cream2)}
.btn-black:hover{background:var(--black2);box-shadow:var(--shadow2)}
.btn-outline{background:transparent;border:1.5px solid var(--border2);color:var(--ink)}
.btn-outline:hover{border-color:var(--black);color:var(--black)}
.btn-sm{padding:6px 14px;font-size:10px;letter-spacing:.8px}
.btn-danger{background:transparent;border:1.5px solid #c0a0a0;color:var(--red)}
.btn-danger:hover{background:#f8f0f0;border-color:var(--red)}

/* KPI ROW */
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.kpi{
  background:var(--white);
  border:1px solid var(--border);
  border-radius:var(--r);padding:20px 22px;
  box-shadow:var(--shadow);
  transition:box-shadow .18s,transform .18s;
  position:relative;overflow:hidden;
}
.kpi:hover{box-shadow:var(--shadow2);transform:translateY(-1px)}
.kpi-accent{
  position:absolute;top:0;left:0;right:0;
  height:3px;background:var(--ka,var(--gold));
}
.kpi-label{
  font-size:9px;color:var(--ink3);
  text-transform:uppercase;letter-spacing:2px;
  font-weight:700;margin-bottom:10px;
}
.kpi-val{
  font-family:'Playfair Display',serif;
  font-size:30px;font-weight:700;
  color:var(--black);line-height:1;
}
.kpi-sub{font-size:11px;color:var(--ink2);margin-top:8px}

/* STAT ROW */
.srow{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:22px}
.sc{
  background:var(--white);border:1px solid var(--border);
  border-radius:var(--r);padding:16px 18px;
  box-shadow:var(--shadow);
}
.sc-l{font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:2px;font-weight:700}
.sc-v{font-family:'Playfair Display',serif;font-size:24px;margin-top:6px;color:var(--black)}

/* TOOLBAR */
.tbar{display:flex;gap:10px;align-items:center;margin-bottom:14px}
.sinput{
  flex:1;background:var(--white);
  border:1.5px solid var(--border);border-radius:4px;
  padding:10px 14px 10px 40px;
  color:var(--black);font-family:'Lato',sans-serif;font-size:12px;
  outline:none;transition:border-color .18s;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 24 24' fill='none' stroke='%238a8278' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:14px center;
  box-shadow:var(--shadow);
}
.sinput:focus{border-color:var(--black)}
.sinput::placeholder{color:var(--ink3)}

/* CHIPS */
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:18px}
.chip{
  padding:5px 14px;border-radius:3px;
  border:1.5px solid var(--border);
  cursor:pointer;font-size:10px;color:var(--ink2);
  background:var(--white);font-weight:700;
  letter-spacing:.5px;text-transform:uppercase;
  transition:all .15s;
}
.chip:hover{border-color:var(--black3);color:var(--black)}
.chip.on{background:var(--black);color:var(--cream2);border-color:var(--black)}

/* TABLE */
.tbox{
  background:var(--white);
  border:1px solid var(--border);
  border-radius:var(--r);overflow:hidden;
  box-shadow:var(--shadow);
}
.tscroll{overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:1200px}
thead{background:var(--black)}
th{
  padding:12px 16px;text-align:left;
  font-size:9px;color:rgba(255,255,255,0.5);
  text-transform:uppercase;letter-spacing:2px;font-weight:700;
  border-bottom:none;white-space:nowrap;
  cursor:pointer;user-select:none;transition:color .15s;
}
th:hover{color:rgba(255,255,255,0.85)}
td{
  padding:13px 16px;
  border-bottom:1px solid var(--cream2);
  font-size:12px;white-space:nowrap;
  vertical-align:middle;color:var(--ink);
}
tr:last-child td{border-bottom:none}
tbody tr:hover td{background:var(--cream)}

/* STATUS PILLS */
.pill{
  display:inline-flex;align-items:center;gap:5px;
  padding:3px 10px;border-radius:3px;
  font-size:9px;font-weight:700;letter-spacing:1px;
  text-transform:uppercase;
}
.pill-dot{width:4px;height:4px;border-radius:50%;background:currentColor}
.p-new{color:#1a3a6b;background:#e8eef8;border:1px solid #b0c0dc}
.p-contacted{color:#0f4a4a;background:#e0f0f0;border:1px solid #a0cece}
.p-qualified{color:#7a5500;background:#f8f0d8;border:1px solid #d4b870}
.p-proposal{color:#4a2a6b;background:#ede8f8;border:1px solid #c0a8dc}
.p-negotiation{color:#6a3000;background:#f8ece0;border:1px solid #d4a880}
.p-won{color:#1a5c3a;background:#e0f0e8;border:1px solid #8ccca8}
.p-lost{color:#7a1f1f;background:#f8e8e8;border:1px solid #d4a0a0}
.p-cold{color:#5a554d;background:#f0ede8;border:1px solid #c4baaa}

/* OVERLAY + MODAL */
.overlay{
  position:fixed;inset:0;background:rgba(15,14,12,0.6);
  z-index:200;display:flex;align-items:center;justify-content:center;
  padding:20px;animation:fi .15s ease;
}
@keyframes fi{from{opacity:0}to{opacity:1}}
.modal{
  background:var(--white);
  border:1px solid var(--border);
  border-radius:var(--r);
  width:100%;max-width:900px;max-height:92vh;
  overflow-y:auto;
  box-shadow:0 24px 64px rgba(15,14,12,0.2);
  animation:ui .2s ease;
}
@keyframes ui{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}
.mh{
  padding:22px 32px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--white);
  position:sticky;top:0;z-index:10;
}
.mh-title{font-family:'Playfair Display',serif;font-size:22px;font-weight:600;color:var(--black)}
.mh-acts{display:flex;gap:8px;align-items:center}
.mb{padding:24px 32px}
.mf{
  padding:16px 32px;border-top:1px solid var(--border);
  display:flex;justify-content:flex-end;gap:10px;
  background:var(--cream);
  position:sticky;bottom:0;
}
.xbtn{
  background:none;border:none;
  color:var(--ink3);cursor:pointer;
  font-size:22px;line-height:1;padding:4px 8px;
  border-radius:4px;transition:all .15s;
}
.xbtn:hover{color:var(--black);background:var(--cream2)}

/* FORM */
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.fg3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.fspan{grid-column:1/-1}
.f{display:flex;flex-direction:column;gap:6px}
.f label{
  font-size:9px;color:var(--ink2);
  text-transform:uppercase;letter-spacing:2px;font-weight:700;
}
.f input,.f select,.f textarea{
  background:var(--cream);
  border:1.5px solid var(--border);border-radius:4px;
  padding:10px 12px;color:var(--black);
  font-family:'Lato',sans-serif;font-size:12px;
  outline:none;transition:border-color .18s;resize:none;
}
.f input:focus,.f select:focus,.f textarea:focus{border-color:var(--black);background:var(--white)}
.fsec{
  font-size:9px;color:var(--ink3);
  text-transform:uppercase;letter-spacing:3px;font-weight:700;
  border-bottom:1.5px solid var(--border);
  padding-bottom:8px;margin:22px 0 16px;
}

/* DETAIL */
.dh{
  background:var(--black);
  border-radius:var(--r);padding:24px;margin-bottom:20px;
  color:var(--cream);
}
.dh-pill{margin-bottom:12px}
.dh-name{font-family:'Playfair Display',serif;font-size:26px;font-weight:600;color:var(--white);margin-top:8px}
.dh-role{font-size:12px;color:rgba(255,255,255,0.45);margin-top:4px}
.dh-meta{display:flex;gap:24px;margin-top:16px;flex-wrap:wrap}
.dh-m{font-size:11px;color:rgba(255,255,255,0.35)}
.dh-m b{color:rgba(255,255,255,0.75);font-weight:400}
.ig{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:18px}
.ic{background:var(--cream);border:1px solid var(--border);border-radius:var(--r);padding:14px 16px}
.ic-l{font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:2px;font-weight:700;margin-bottom:6px}
.ic-v{font-size:13px;color:var(--black);line-height:1.5}
.tabs{display:flex;gap:0;border-bottom:2px solid var(--cream3);margin-bottom:20px}
.tab{
  padding:10px 22px;cursor:pointer;font-size:11px;
  color:var(--ink3);border-bottom:2px solid transparent;
  margin-bottom:-2px;transition:all .15s;
  font-weight:700;letter-spacing:1px;text-transform:uppercase;
}
.tab:hover{color:var(--black)}
.tab.on{color:var(--black);border-bottom-color:var(--black)}
.pbar{height:4px;background:var(--cream3);border-radius:2px;margin-top:10px;overflow:hidden}
.pfill{height:100%;border-radius:2px;background:var(--black)}
.tl{border-left:2px solid var(--cream3);padding-left:18px;margin-top:4px}
.tl-item{position:relative;margin-bottom:18px}
.tl-dot{position:absolute;left:-24px;top:4px;width:8px;height:8px;border-radius:50%;background:var(--black);border:2px solid var(--cream)}
.tl-d{font-size:10px;color:var(--ink3);font-weight:700;letter-spacing:1px;text-transform:uppercase}
.tl-t{font-size:12px;color:var(--ink);margin-top:3px}

/* PIPELINE */
.pipeline{display:flex;gap:16px;overflow-x:auto;padding-bottom:16px}
.pl-col{min-width:240px;flex-shrink:0}
.pl-head{
  padding:11px 16px;
  border-radius:var(--r) var(--r) 0 0;
  font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;
}
.pl-body{
  background:var(--white);border:1px solid var(--border);
  border-top:none;border-radius:0 0 var(--r) var(--r);
  padding:10px;min-height:140px;box-shadow:var(--shadow);
}
.pl-card{
  background:var(--cream);
  border:1px solid var(--border);border-radius:4px;
  padding:13px;margin-bottom:8px;cursor:pointer;
  transition:all .18s;
}
.pl-card:hover{background:var(--white);border-color:var(--black3);box-shadow:var(--shadow)}
.pl-cn{font-size:12px;font-weight:700;color:var(--black)}
.pl-co{font-size:10px;color:var(--ink3);margin-top:3px}
.pl-v{font-size:12px;color:var(--gold);font-weight:700;margin-top:8px}
.pl-prob{font-size:10px;color:var(--ink3);margin-top:3px}

/* ANALYTICS */
.ag{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.ap{background:var(--white);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;box-shadow:var(--shadow)}
.ap-h{
  padding:14px 20px;border-bottom:1px solid var(--border);
  font-size:9px;color:var(--ink3);
  text-transform:uppercase;letter-spacing:2.5px;font-weight:700;
  background:var(--cream);
}
.ap-b{padding:18px 20px}
.cr{display:flex;align-items:center;gap:12px;margin-bottom:11px;font-size:11px}
.cl{width:120px;color:var(--ink2);text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:0;font-weight:500}
.ct{flex:1;height:5px;background:var(--cream3);border-radius:2px;overflow:hidden}
.cf{height:100%;border-radius:2px}
.cv{width:80px;color:var(--ink);font-weight:700}

/* DASHBOARD */
.dg{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:22px}
.dp{background:var(--white);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;box-shadow:var(--shadow)}
.dp-h{
  padding:14px 20px;border-bottom:1px solid var(--border);
  font-size:9px;color:var(--ink3);
  text-transform:uppercase;letter-spacing:2.5px;font-weight:700;
  background:var(--cream);display:flex;align-items:center;gap:8px;
}
.dp-b{padding:8px}
.uitem{
  display:flex;align-items:flex-start;justify-content:space-between;
  padding:11px 14px;cursor:pointer;border-radius:3px;
  transition:background .15s;gap:12px;
  border-bottom:1px solid var(--cream2);
}
.uitem:last-child{border-bottom:none}
.uitem:hover{background:var(--cream)}
.uitem-co{font-size:12px;font-weight:700;color:var(--black)}
.uitem-ac{font-size:11px;color:var(--ink2);margin-top:3px}
.uitem-dt{font-size:10px;flex-shrink:0;font-weight:700;letter-spacing:.5px}

/* LOADING */
.loadscreen{
  position:fixed;inset:0;background:var(--black);
  display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999;
}
.ls-w{font-family:'Playfair Display',serif;font-size:48px;font-weight:700;color:var(--cream);margin-bottom:4px}
.ls-t{font-size:9px;color:rgba(255,255,255,0.2);letter-spacing:4px;text-transform:uppercase;margin-bottom:48px}
.spin{width:24px;height:24px;border:2px solid rgba(255,255,255,0.1);border-top-color:var(--gold2);border-radius:50%;animation:sp .8s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.ls-s{font-size:11px;color:rgba(255,255,255,0.25);margin-top:16px;letter-spacing:1px}

/* EMPTY */
.empty{text-align:center;padding:56px 24px;color:var(--ink3)}
.empty-i{font-size:40px;margin-bottom:14px;opacity:.3}

/* TOAST */
.toast{
  position:fixed;bottom:28px;right:28px;z-index:600;
  padding:13px 22px;border-radius:4px;font-size:12px;font-weight:700;
  letter-spacing:.5px;box-shadow:0 8px 32px rgba(15,14,12,.2);
  animation:ui .2s ease;border-left:4px solid;
}

.val{color:var(--gold);font-weight:700}
.over{color:var(--red)}

::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--cream2)}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
::-webkit-scrollbar-thumb:hover{background:var(--ink3)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useMemo} = React;

// ‚îÄ‚îÄ GITHUB CLOUD STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GH_TOKEN = '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';
const GH_OWNER = 'CoreSight-sa';
const GH_REPO  = 'coresight-crm';
const GH_FILE  = 'data/leads.json';
const GH_API   = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_FILE}`;
const GH_H = {
  'Authorization':`Bearer ${GH_TOKEN}`,
  'Accept':'application/vnd.github+json',
  'Content-Type':'application/json',
  'X-GitHub-Api-Version':'2022-11-28'
};
async function ghLoad() {
  const r = await fetch(GH_API+'?t='+Date.now(),{headers:GH_H});
  if(r.status===404) return {data:[],sha:null};
  if(!r.ok) throw new Error('HTTP '+r.status);
  const j = await r.json();
  return {data:JSON.parse(atob(j.content.replace(/\s/g,''))),sha:j.sha};
}
async function ghSave(data,sha) {
  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2))));
  const body = {message:'crm:save '+new Date().toISOString(),content:encoded};
  if(sha) body.sha=sha;
  const r = await fetch(GH_API,{method:'PUT',headers:GH_H,body:JSON.stringify(body)});
  if(!r.ok){const e=await r.json();throw new Error(e.message);}
  return (await r.json()).content.sha;
}
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const STATUSES  = ['New','Contacted','Qualified','Proposal Sent','Negotiation','Won','Lost','Cold'];
const INDUSTRIES= ['HR Consulting','Training & Development','Talent Acquisition','SHRM/CIPD Prep','Organizational Development','Government','Oil & Gas','Finance','Healthcare','Technology','Retail','Other'];
const SIZES     = ['1-10','11-50','51-200','201-500','501-2000','2000+'];
const SOURCES   = ['LinkedIn','Referral','Website','Conference','Cold Call','Email Campaign','Partner','Other'];
const SERVICES  = ['HR Consulting','Training Programs','SHRM Certification Prep','CIPD Prep','Succession Planning','Workforce Planning','360¬∞ Feedback','Employee Engagement','Talent Assessment','OD Consulting'];
const COUNTRIES = ['Saudi Arabia','UAE','Kuwait','Qatar','Bahrain','Oman','Jordan','Egypt','Other'];

const PC = {'New':'p-new','Contacted':'p-contacted','Qualified':'p-qualified','Proposal Sent':'p-proposal','Negotiation':'p-negotiation','Won':'p-won','Lost':'p-lost','Cold':'p-cold'};
const SC = {'New':'#1a3a6b','Contacted':'#0f4a4a','Qualified':'#7a5500','Proposal Sent':'#4a2a6b','Negotiation':'#6a3000','Won':'#1a5c3a','Lost':'#7a1f1f','Cold':'#5a554d'};
const SB = {'New':'#e8eef8','Contacted':'#e0f0f0','Qualified':'#f8f0d8','Proposal Sent':'#ede8f8','Negotiation':'#f8ece0','Won':'#e0f0e8','Lost':'#f8e8e8','Cold':'#f0ede8'};

const fv = n => n?'$'+Number(n).toLocaleString():'‚Äî';
const fd = d => {if(!d)return '‚Äî';return new Date(d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});};
const od = d => d&&new Date(d)<new Date();

function App() {
  const [view,   setView]   = useState('dashboard');
  const [leads,  setLeads]  = useState([]);
  const [sha,    setSha]    = useState(null);
  const [sync,   setSync]   = useState('loading');
  const [search, setSearch] = useState('');
  const [filter, setFilter] = useState('All');
  const [modal,  setModal]  = useState(false);
  const [editId, setEditId] = useState(null);
  const [detail, setDetail] = useState(null);
  const [dtab,   setDtab]   = useState('overview');
  const [form,   setForm]   = useState({});
  const [toast,  setToast]  = useState(null);
  const [sortC,  setSortC]  = useState('lastContact');
  const [sortD,  setSortD]  = useState('desc');
  const timer  = useRef(null);
  const latSha = useRef(null);
  useEffect(()=>{latSha.current=sha;},[sha]);

  useEffect(()=>{
    ghLoad().then(({data,sha})=>{setLeads(data);setSha(sha);setSync('ok');}).catch(()=>setSync('error'));
  },[]);

  const showToast = (msg,type='ok')=>{setToast({msg,type});setTimeout(()=>setToast(null),3000);};

  const save = (nl)=>{
    if(timer.current) clearTimeout(timer.current);
    setSync('saving');
    timer.current=setTimeout(async()=>{
      try{const s=await ghSave(nl,latSha.current);setSha(s);setSync('ok');showToast('Saved successfully');}
      catch(e){setSync('error');showToast('Save failed','err');}
    },1400);
  };

  const mutate = fn=>setLeads(prev=>{const next=fn(prev);save(next);return next;});

  const rows = useMemo(()=>{
    let ls=leads;
    if(filter!=='All') ls=ls.filter(l=>l.status===filter);
    if(search){const s=search.toLowerCase();ls=ls.filter(l=>[l.company,l.contact,l.industry,l.country,l.service,l.status,l.owner].some(v=>v&&v.toLowerCase().includes(s)));}
    return [...ls].sort((a,b)=>{const av=a[sortC],bv=b[sortC];if(typeof av==='number')return sortD==='asc'?av-bv:bv-av;return sortD==='asc'?String(av||'').localeCompare(String(bv||'')):String(bv||'').localeCompare(String(av||''));});
  },[leads,filter,search,sortC,sortD]);

  const stats = useMemo(()=>{
    const active=leads.filter(l=>!['Won','Lost','Cold'].includes(l.status));
    const won=leads.filter(l=>l.status==='Won');
    return {
      total:leads.length,
      pipeline:active.reduce((s,l)=>s+Number(l.dealValue||0),0),
      won:won.reduce((s,l)=>s+Number(l.dealValue||0),0),
      winRate:leads.length?Math.round(won.length/leads.length*100):0,
      weighted:active.reduce((s,l)=>s+Number(l.dealValue||0)*Number(l.prob||0)/100,0),
    };
  },[leads]);

  const openNew = ()=>{setForm({status:'New',country:'Saudi Arabia',source:'LinkedIn',industry:'HR Consulting',size:'51-200',prob:20,owner:'Hussein Al-Hamdan'});setEditId(null);setModal(true);};
  const openEdit = l=>{setForm({...l});setEditId(l.id);setModal(true);};
  const saveLead = ()=>{
    if(!form.company||!form.contact) return alert('Company and Contact Name are required');
    if(editId){mutate(ls=>ls.map(l=>l.id===editId?{...form,id:editId}:l));if(detail?.id===editId)setDetail({...form,id:editId});showToast('Lead updated');}
    else{const nl={...form,id:Date.now()};mutate(ls=>[...ls,nl]);showToast('Lead added');}
    setModal(false);
  };
  const delLead = id=>{
    if(!confirm('Delete this lead?')) return;
    mutate(ls=>ls.filter(l=>l.id!==id));
    if(detail?.id===id) setDetail(null);
    showToast('Lead deleted');
  };
  const sortBy = col=>{if(sortC===col)setSortD(d=>d==='asc'?'desc':'asc');else{setSortC(col);setSortD('asc');}};
  const SI = ({c})=><span style={{marginLeft:4,opacity:.4,fontSize:10}}>{sortC===c?sortD==='asc'?'‚Üë':'‚Üì':'‚Üï'}</span>;
  const kanban = useMemo(()=>STATUSES.slice(0,6).map(s=>({s,ls:leads.filter(l=>l.status===s)})),[leads]);
  const syncClr = {loading:'#5b8dd9',saving:'#b8922a',ok:'#1a5c3a',error:'#7a1f1f'}[sync];
  const syncLbl = {loading:'Connecting...',saving:'Saving...',ok:'All changes saved',error:'Sync error'}[sync];

  if(sync==='loading') return (
    <div className="loadscreen">
      <div className="ls-w">Coresight</div>
      <div className="ls-t">CRM Agent</div>
      <div className="spin"/>
      <div className="ls-s">Loading your data...</div>
    </div>
  );

  const views = {
    dashboard: 'Dashboard',
    leads: 'Leads',
    pipeline: 'Pipeline',
    analytics: 'Analytics',
  };

  return <>
    {/* SIDEBAR */}
    <div className="sb">
      <div className="sb-logo">
        <div className="sb-name">Core<span>sight</span></div>
        <div className="sb-tag">CRM Agent</div>
      </div>
      <nav className="sb-nav">
        <div className="sb-sect">Main</div>
        {[['dashboard','‚ñ¶','Dashboard'],['leads','‚óà','Leads'],['pipeline','‚äû','Pipeline'],['analytics','‚¨°','Analytics']].map(([k,ic,lb])=>(
          <div key={k} className={`sb-item ${view===k?'active':''}`} onClick={()=>setView(k)}>
            <span className="sb-ico">{ic}</span>{lb}
          </div>
        ))}
        <div className="sb-sect" style={{marginTop:18}}>Quick</div>
        <div className="sb-item" onClick={openNew}><span className="sb-ico">Ôºã</span>New Lead</div>
      </nav>
      <div className="sb-bottom">
        <div className="sync-box">
          <div className="sync-row">
            <div className={`sdot ${sync}`}/>
            <div className="slabel" style={{color:syncClr}}>{syncLbl}</div>
          </div>
          <div className="sdetail">{leads.length} leads ¬∑ Auto-save enabled</div>
        </div>
      </div>
    </div>

    {/* MAIN */}
    <div className="main">
      <div className="topbar">
        <div className="topbar-left">
          <div className="topbar-eyebrow">{views[view]}</div>
          <div className="topbar-title">{view==='leads'?`${rows.length} of ${leads.length} Records`:view==='dashboard'?new Date().toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'}):view==='pipeline'?'Kanban by Stage':'Revenue & Performance'}</div>
        </div>
        <div className="topbar-actions">
          <button className="btn btn-black" onClick={openNew}>Ôºã New Lead</button>
        </div>
      </div>

      <div className="content">

        {/* DASHBOARD */}
        {view==='dashboard'&&<>
          <div className="kpi-row">
            {[
              {label:'Active Pipeline',val:fv(stats.pipeline),sub:`${leads.filter(l=>!['Won','Lost','Cold'].includes(l.status)).length} active deals`,ka:'var(--gold)'},
              {label:'Weighted Pipeline',val:fv(Math.round(stats.weighted)),sub:'Probability adjusted',ka:'var(--blue)'},
              {label:'Closed Won',val:fv(stats.won),sub:`Win rate: ${stats.winRate}%`,ka:'var(--green)'},
              {label:'Total Leads',val:stats.total,sub:`Avg: ${fv(leads.length?Math.round(leads.reduce((s,l)=>s+Number(l.dealValue||0),0)/leads.length):0)}`,ka:'var(--black)'},
            ].map(({label,val,sub,ka})=>(
              <div key={label} className="kpi" style={{'--ka':ka}}>
                <div className="kpi-accent"/>
                <div className="kpi-label">{label}</div>
                <div className="kpi-val">{val}</div>
                <div className="kpi-sub">{sub}</div>
              </div>
            ))}
          </div>
          <div className="dg">
            <div className="dp">
              <div className="dp-h">Pipeline by Status</div>
              <div className="dp-b" style={{padding:'16px 20px'}}>
                {STATUSES.map(s=>{const c=leads.filter(l=>l.status===s).length;return c>0&&(
                  <div key={s} className="cr">
                    <div className="cl" style={{color:SC[s],fontWeight:700}}>{s}</div>
                    <div className="ct"><div className="cf" style={{width:`${c/leads.length*100}%`,background:SC[s]}}/></div>
                    <div className="cv">{c}</div>
                  </div>
                );})}
                {leads.length===0&&<div className="empty"><div className="empty-i">‚óé</div><div>No leads yet</div></div>}
              </div>
            </div>
            <div className="dp">
              <div className="dp-h">Upcoming Actions</div>
              <div className="dp-b">
                {leads.filter(l=>l.nextDue&&!['Won','Lost'].includes(l.status)).sort((a,b)=>a.nextDue.localeCompare(b.nextDue)).slice(0,8).map(l=>(
                  <div key={l.id} className="uitem" onClick={()=>{setDetail(l);setDtab('overview');}}>
                    <div>
                      <div className="uitem-co">{l.company}</div>
                      <div className="uitem-ac">{l.nextAction||'‚Äî'}</div>
                    </div>
                    <div className="uitem-dt" style={{color:od(l.nextDue)?'var(--red)':'var(--ink3)'}}>{fd(l.nextDue)}</div>
                  </div>
                ))}
                {leads.filter(l=>l.nextDue).length===0&&<div className="empty"><div className="empty-i">üìÖ</div><div>No upcoming actions</div></div>}
              </div>
            </div>
          </div>
        </>}

        {/* LEADS */}
        {view==='leads'&&<>
          <div className="srow">
            <div className="sc"><div className="sc-l">Total</div><div className="sc-v">{stats.total}</div></div>
            <div className="sc"><div className="sc-l">Pipeline</div><div className="sc-v" style={{color:'var(--blue)',fontSize:20}}>{fv(stats.pipeline)}</div></div>
            <div className="sc"><div className="sc-l">Won</div><div className="sc-v" style={{color:'var(--green)',fontSize:20}}>{fv(stats.won)}</div></div>
            <div className="sc"><div className="sc-l">Win Rate</div><div className="sc-v">{stats.winRate}%</div></div>
            <div className="sc"><div className="sc-l">Weighted</div><div className="sc-v" style={{fontSize:18}}>{fv(Math.round(stats.weighted))}</div></div>
          </div>
          <div className="tbar">
            <input className="sinput" placeholder="Search by company, contact, country, service..." value={search} onChange={e=>setSearch(e.target.value)}/>
            {search&&<button className="btn btn-outline btn-sm" onClick={()=>setSearch('')}>‚úï Clear</button>}
          </div>
          <div className="chips">
            {['All',...STATUSES].map(s=><div key={s} className={`chip ${filter===s?'on':''}`} onClick={()=>setFilter(s)}>{s}</div>)}
          </div>
          <div className="tbox">
            <div className="tscroll">
              <table>
                <thead>
                  <tr>
                    {[['company','Company'],['country','Country'],['contact','Contact'],['service','Service'],['status','Status'],['dealValue','Value'],['prob','Prob'],['nextDue','Next Due'],['lastContact','Last Contact'],['owner','Owner']].map(([c,l])=>(
                      <th key={c} onClick={()=>sortBy(c)}>{l}<SI c={c}/></th>
                    ))}
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {rows.map(l=>(
                    <tr key={l.id}>
                      <td>
                        <div style={{fontWeight:700,cursor:'pointer',color:'var(--black)'}} onClick={()=>{setDetail(l);setDtab('overview');}}>{l.company}</div>
                        <div style={{fontSize:10,color:'var(--ink3)',marginTop:2,letterSpacing:'.5px'}}>{l.industry}</div>
                      </td>
                      <td>{l.country||'‚Äî'}</td>
                      <td>
                        <div style={{fontWeight:700}}>{l.contact}</div>
                        <div style={{fontSize:10,color:'var(--ink3)',marginTop:2}}>{l.title}</div>
                      </td>
                      <td style={{maxWidth:130,overflow:'hidden',textOverflow:'ellipsis'}}>{l.service||'‚Äî'}</td>
                      <td><span className={`pill ${PC[l.status]||'p-cold'}`}><span className="pill-dot"/> {l.status}</span></td>
                      <td className="val">{fv(l.dealValue)}</td>
                      <td>
                        <div style={{display:'flex',alignItems:'center',gap:7}}>
                          <span style={{fontWeight:700}}>{l.prob||0}%</span>
                          <div style={{width:40,height:3,background:'var(--cream3)',borderRadius:2,overflow:'hidden'}}>
                            <div style={{width:`${l.prob||0}%`,height:'100%',background:'var(--black)',borderRadius:2}}/>
                          </div>
                        </div>
                      </td>
                      <td className={od(l.nextDue)?'over':''}>{fd(l.nextDue)}</td>
                      <td style={{color:'var(--ink2)'}}>{fd(l.lastContact)}</td>
                      <td style={{color:'var(--ink2)'}}>{l.owner||'‚Äî'}</td>
                      <td>
                        <div style={{display:'flex',gap:6}}>
                          <button className="btn btn-outline btn-sm" onClick={()=>{setDetail(l);setDtab('overview');}}>View</button>
                          <button className="btn btn-outline btn-sm" onClick={()=>openEdit(l)}>Edit</button>
                          <button className="btn btn-danger btn-sm" onClick={()=>delLead(l.id)}>‚úï</button>
                        </div>
                      </td>
                    </tr>
                  ))}
                  {rows.length===0&&(
                    <tr><td colSpan={11}>
                      <div className="empty">
                        <div className="empty-i">‚óé</div>
                        <div style={{fontSize:14,fontWeight:700,marginBottom:6}}>{leads.length===0?'No leads yet':'Nothing matches'}</div>
                        <div style={{fontSize:12}}>{leads.length===0?'Click "+ New Lead" to get started':'Try adjusting your search or filter'}</div>
                      </div>
                    </td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </>}

        {/* PIPELINE */}
        {view==='pipeline'&&<>
          <div className="pipeline">
            {kanban.map(({s,ls})=>(
              <div key={s} className="pl-col">
                <div className="pl-head" style={{background:SC[s],color:'#fff',border:`1px solid ${SC[s]}`}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                    <span>{s}</span><span style={{opacity:.7,fontSize:10}}>{ls.length}</span>
                  </div>
                  <div style={{fontSize:11,marginTop:4,opacity:.8}}>{fv(ls.reduce((a,l)=>a+Number(l.dealValue||0),0))}</div>
                </div>
                <div className="pl-body">
                  {ls.map(l=>(
                    <div key={l.id} className="pl-card" onClick={()=>{setDetail(l);setDtab('overview');setView('leads');}}>
                      <div className="pl-cn">{l.contact}</div>
                      <div className="pl-co">{l.company}</div>
                      <div className="pl-v">{fv(l.dealValue)}</div>
                      <div className="pl-prob">{l.prob||0}% ¬∑ {fd(l.nextDue)}</div>
                    </div>
                  ))}
                  {ls.length===0&&<div style={{textAlign:'center',color:'var(--ink3)',fontSize:11,padding:'24px 0'}}>Empty</div>}
                </div>
              </div>
            ))}
          </div>
        </>}

        {/* ANALYTICS */}
        {view==='analytics'&&<>
          <div className="srow" style={{marginBottom:20}}>
            <div className="sc"><div className="sc-l">Portfolio</div><div className="sc-v" style={{fontSize:18}}>{fv(leads.reduce((s,l)=>s+Number(l.dealValue||0),0))}</div></div>
            <div className="sc"><div className="sc-l">Pipeline</div><div className="sc-v" style={{color:'var(--blue)',fontSize:18}}>{fv(stats.pipeline)}</div></div>
            <div className="sc"><div className="sc-l">Won</div><div className="sc-v" style={{color:'var(--green)',fontSize:18}}>{fv(stats.won)}</div></div>
            <div className="sc"><div className="sc-l">Win Rate</div><div className="sc-v">{stats.winRate}%</div></div>
            <div className="sc"><div className="sc-l">Avg Deal</div><div className="sc-v" style={{fontSize:16}}>{leads.length?fv(Math.round(leads.reduce((s,l)=>s+Number(l.dealValue||0),0)/leads.length)):'‚Äî'}</div></div>
          </div>
          <div className="ag">
            {[
              {title:'Deal Value by Country',rows:COUNTRIES.map(c=>({k:c,v:leads.filter(l=>l.country===c).reduce((s,l)=>s+Number(l.dealValue||0),0)})).filter(x=>x.v>0).sort((a,b)=>b.v-a.v),fmt:fv,color:'var(--blue)'},
              {title:'Leads by Industry',rows:INDUSTRIES.map(i=>({k:i,v:leads.filter(l=>l.industry===i).length})).filter(x=>x.v>0).sort((a,b)=>b.v-a.v),fmt:v=>v,color:'var(--teal)'},
              {title:'Pipeline by Status',rows:STATUSES.map(s=>({k:s,v:leads.filter(l=>l.status===s).reduce((a,l)=>a+Number(l.dealValue||0),0)})).filter(x=>x.v>0).sort((a,b)=>b.v-a.v),fmt:fv,color:null},
              {title:'Leads by Source',rows:SOURCES.map(s=>({k:s,v:leads.filter(l=>l.source===s).length})).filter(x=>x.v>0).sort((a,b)=>b.v-a.v),fmt:v=>v,color:'var(--purple)'},
            ].map(({title,rows,fmt,color})=>{
              const max=Math.max(...rows.map(x=>x.v),1);
              return(
                <div key={title} className="ap">
                  <div className="ap-h">{title}</div>
                  <div className="ap-b">
                    {rows.length?rows.map(({k,v})=>(
                      <div key={k} className="cr">
                        <div className="cl">{k}</div>
                        <div className="ct"><div className="cf" style={{width:`${v/max*100}%`,background:color||SC[k]||'var(--blue)'}}/></div>
                        <div className="cv">{fmt(v)}</div>
                      </div>
                    )):<div className="empty" style={{padding:24}}><div>No data yet</div></div>}
                  </div>
                </div>
              );
            })}
          </div>
        </>}
      </div>
    </div>

    {/* DETAIL MODAL */}
    {detail&&(
      <div className="overlay" onClick={e=>e.target===e.currentTarget&&setDetail(null)}>
        <div className="modal">
          <div className="mh">
            <div className="mh-title">{detail.company}</div>
            <div className="mh-acts">
              <button className="btn btn-outline btn-sm" onClick={()=>{setDetail(null);openEdit(detail);}}>Edit Lead</button>
              <button className="btn btn-danger btn-sm" onClick={()=>delLead(detail.id)}>Delete</button>
              <button className="xbtn" onClick={()=>setDetail(null)}>√ó</button>
            </div>
          </div>
          <div className="mb">
            <div className="dh">
              <div className="dh-pill"><span className={`pill ${PC[detail.status]||'p-cold'}`} style={{background:'rgba(255,255,255,.1)',border:'1px solid rgba(255,255,255,.15)',color:'#fff'}}><span className="pill-dot"/> {detail.status}</span></div>
              <div className="dh-name">{detail.contact}</div>
              <div className="dh-role">{[detail.title,detail.company].filter(Boolean).join(' ¬∑ ')}</div>
              <div className="dh-meta">
                {detail.email&&<div className="dh-m">üìß <b>{detail.email}</b></div>}
                {detail.phone&&<div className="dh-m">üìû <b>{detail.phone}</b></div>}
                {detail.country&&<div className="dh-m">üåç <b>{detail.country}</b></div>}
                {detail.industry&&<div className="dh-m">üè¢ <b>{detail.industry}</b></div>}
              </div>
            </div>
            <div className="tabs">
              {['overview','deal','activity'].map(t=>(
                <div key={t} className={`tab ${dtab===t?'on':''}`} onClick={()=>setDtab(t)}>{t.toUpperCase()}</div>
              ))}
            </div>
            {dtab==='overview'&&(
              <div className="ig">
                {[['Source',detail.source],['First Contact',fd(detail.firstContact)],['Last Contact',fd(detail.lastContact)],['Company Size',detail.size],['Service',detail.service],['Collaboration',detail.collab||'TBD'],['Owner',detail.owner]].map(([l,v])=>(
                  <div key={l} className="ic"><div className="ic-l">{l}</div><div className="ic-v">{v||'‚Äî'}</div></div>
                ))}
                <div className="ic fspan"><div className="ic-l">Client Need / Pain Point</div><div className="ic-v" style={{lineHeight:1.7,color:'var(--ink)'}}>{detail.need||'‚Äî'}</div></div>
                <div className="ic fspan"><div className="ic-l">Notes</div><div className="ic-v" style={{lineHeight:1.7,color:'var(--ink)'}}>{detail.notes||'‚Äî'}</div></div>
              </div>
            )}
            {dtab==='deal'&&(
              <div className="ig">
                <div className="ic"><div className="ic-l">Deal Value</div><div className="ic-v" style={{fontSize:22,fontFamily:'Playfair Display',fontWeight:700,color:'var(--gold)'}}>{fv(detail.dealValue)}</div></div>
                <div className="ic"><div className="ic-l">Probability</div>
                  <div className="ic-v" style={{fontSize:22,fontFamily:'Playfair Display',fontWeight:700}}>{detail.prob||0}%
                    <div className="pbar"><div className="pfill" style={{width:`${detail.prob||0}%`}}/></div>
                  </div>
                </div>
                <div className="ic"><div className="ic-l">Expected Value</div><div className="ic-v" style={{fontSize:22,fontFamily:'Playfair Display',fontWeight:700,color:'var(--green)'}}>{fv(Math.round(Number(detail.dealValue||0)*Number(detail.prob||0)/100))}</div></div>
                <div className="ic"><div className="ic-l">Next Action</div><div className="ic-v">{detail.nextAction||'‚Äî'}</div></div>
                <div className="ic"><div className="ic-l">Due Date</div><div className="ic-v" style={{color:od(detail.nextDue)?'var(--red)':'inherit',fontWeight:od(detail.nextDue)?700:400}}>{fd(detail.nextDue)}{od(detail.nextDue)?' ‚Äî OVERDUE':''}</div></div>
                <div className="ic"><div className="ic-l">Owner</div><div className="ic-v">{detail.owner||'‚Äî'}</div></div>
              </div>
            )}
            {dtab==='activity'&&(
              <div className="tl">
                {[{d:detail.firstContact,t:`First contact via ${detail.source||'‚Äî'}`},{d:detail.lastContact,t:`Last interaction ‚Äî ${detail.status}`},{d:detail.nextDue,t:`Upcoming: ${detail.nextAction||'No action set'}`}].filter(a=>a.d).sort((a,b)=>a.d.localeCompare(b.d)).map((a,i)=>(
                  <div key={i} className="tl-item">
                    <div className="tl-dot"/>
                    <div className="tl-d">{fd(a.d)}</div>
                    <div className="tl-t">{a.t}</div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    )}

    {/* ADD/EDIT MODAL */}
    {modal&&(
      <div className="overlay" onClick={e=>e.target===e.currentTarget&&setModal(false)}>
        <div className="modal">
          <div className="mh">
            <div className="mh-title">{editId?'Edit Lead':'New Lead'}</div>
            <button className="xbtn" onClick={()=>setModal(false)}>√ó</button>
          </div>
          <div className="mb">
            <div className="fsec">Company</div>
            <div className="fg2">
              <div className="f"><label>Company Name *</label><input value={form.company||''} onChange={e=>setForm(f=>({...f,company:e.target.value}))} placeholder="Company name"/></div>
              <div className="f"><label>Country</label><select value={form.country||''} onChange={e=>setForm(f=>({...f,country:e.target.value}))}>{COUNTRIES.map(c=><option key={c}>{c}</option>)}</select></div>
              <div className="f"><label>Industry</label><select value={form.industry||''} onChange={e=>setForm(f=>({...f,industry:e.target.value}))}>{INDUSTRIES.map(i=><option key={i}>{i}</option>)}</select></div>
              <div className="f"><label>Company Size</label><select value={form.size||''} onChange={e=>setForm(f=>({...f,size:e.target.value}))}>{SIZES.map(s=><option key={s}>{s}</option>)}</select></div>
            </div>
            <div className="fsec">Contact</div>
            <div className="fg2">
              <div className="f"><label>Contact Name *</label><input value={form.contact||''} onChange={e=>setForm(f=>({...f,contact:e.target.value}))} placeholder="Full name"/></div>
              <div className="f"><label>Job Title</label><input value={form.title||''} onChange={e=>setForm(f=>({...f,title:e.target.value}))} placeholder="e.g. CHRO"/></div>
              <div className="f"><label>Email</label><input type="email" value={form.email||''} onChange={e=>setForm(f=>({...f,email:e.target.value}))} placeholder="name@company.com"/></div>
              <div className="f"><label>Phone</label><input value={form.phone||''} onChange={e=>setForm(f=>({...f,phone:e.target.value}))} placeholder="+966-11-555-0000"/></div>
            </div>
            <div className="fsec">Lead Details</div>
            <div className="fg2">
              <div className="f"><label>Lead Source</label><select value={form.source||''} onChange={e=>setForm(f=>({...f,source:e.target.value}))}>{SOURCES.map(s=><option key={s}>{s}</option>)}</select></div>
              <div className="f"><label>Status</label><select value={form.status||''} onChange={e=>setForm(f=>({...f,status:e.target.value}))}>{STATUSES.map(s=><option key={s}>{s}</option>)}</select></div>
              <div className="f"><label>First Contact Date</label><input type="date" value={form.firstContact||''} onChange={e=>setForm(f=>({...f,firstContact:e.target.value}))}/></div>
              <div className="f"><label>Last Contact Date</label><input type="date" value={form.lastContact||''} onChange={e=>setForm(f=>({...f,lastContact:e.target.value}))}/></div>
              <div className="f fspan"><label>Service / Offer Discussed</label><select value={form.service||''} onChange={e=>setForm(f=>({...f,service:e.target.value}))}><option value="">Select service...</option>{SERVICES.map(s=><option key={s}>{s}</option>)}</select></div>
              <div className="f fspan"><label>Client Need / Pain Point</label><textarea rows={2} value={form.need||''} onChange={e=>setForm(f=>({...f,need:e.target.value}))} placeholder="Describe the client's main challenge..."/></div>
            </div>
            <div className="fsec">Deal</div>
            <div className="fg3">
              <div className="f"><label>Deal Value ($)</label><input type="number" value={form.dealValue||''} onChange={e=>setForm(f=>({...f,dealValue:Number(e.target.value)}))} placeholder="0"/></div>
              <div className="f"><label>Probability (%)</label><input type="number" min="0" max="100" value={form.prob||''} onChange={e=>setForm(f=>({...f,prob:Number(e.target.value)}))} placeholder="0"/></div>
              <div className="f"><label>Owner</label><input value={form.owner||''} onChange={e=>setForm(f=>({...f,owner:e.target.value}))} placeholder="Name"/></div>
              <div className="f"><label>Expected Collaboration</label><input value={form.collab||''} onChange={e=>setForm(f=>({...f,collab:e.target.value}))} placeholder="e.g. 12 months"/></div>
              <div className="f"><label>Next Action</label><input value={form.nextAction||''} onChange={e=>setForm(f=>({...f,nextAction:e.target.value}))} placeholder="e.g. Send proposal"/></div>
              <div className="f"><label>Next Action Due Date</label><input type="date" value={form.nextDue||''} onChange={e=>setForm(f=>({...f,nextDue:e.target.value}))}/></div>
              <div className="f fspan"><label>Notes</label><textarea rows={2} value={form.notes||''} onChange={e=>setForm(f=>({...f,notes:e.target.value}))} placeholder="Additional notes..."/></div>
            </div>
          </div>
          <div className="mf">
            <button className="btn btn-outline" onClick={()=>setModal(false)}>Cancel</button>
            <button className="btn btn-black" onClick={saveLead}>{editId?'Update Lead':'Add Lead'}</button>
          </div>
        </div>
      </div>
    )}

    {toast&&(
      <div className="toast" style={{
        background:toast.type==='ok'?'#f0f8f4':'#fdf0f0',
        borderLeftColor:toast.type==='ok'?'var(--green)':'var(--red)',
        color:toast.type==='ok'?'var(--green)':'var(--red)',
      }}>{toast.msg}</div>
    )}
  </>;
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
